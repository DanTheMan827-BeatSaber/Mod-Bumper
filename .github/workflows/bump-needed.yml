name: "Trigger: Bump Needed Mods"

on:
  workflow_dispatch:
  workflow_call:

permissions:
  contents: write
  actions: write

jobs:
  dispatch:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger bump.yml workflow on same ref
        run: |
          WORKFLOW_FILE="bump.yml"
          REF="${{ github.ref }}"

          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" \
            -X POST \
            -H "Authorization: token ${{ secrets.PAT_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/$WORKFLOW_FILE/dispatches \
            -d "{\"ref\":\"$REF\",\"inputs\":{\"type\":\"Bump Needed Mods\"}}")

          echo "HTTP response: $RESPONSE"
          if [ "$RESPONSE" -ne 204 ]; then
            echo "workflow_dispatch failed"
            exit 1
          fi